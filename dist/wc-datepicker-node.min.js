export class Datepicker extends HTMLElement{constructor(){super(),this.dayNames=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],this.monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.sundayFirst=!1,this.persistOnSelect=!1,this.longPressThreshold=500,this.longPressInterval=150,this.initDate=null,this.ignoreOnFocus=!1,this.showCloseIcon=!1,this.i=!1,this.t=[],this.l=[],this.h='<style>#calContainer{border:1px solid black;position:absolute;background-color:white;z-index:1000;}#calHeader{display:flex;align-items:center;justify-content:space-around;margin-top:5px;}#calGrid{display:grid;grid-template-columns:auto auto auto auto auto auto auto;padding:10px;}.calDayName, .calDayStyle, .calAdjacentMonthDay, #calTitle{padding:5px;font-size:20px;text-align:center;}.calDayStyle:hover, .calCtrl:hover{color:white;background-color:black;cursor:default;}.calHiddenRow{display:none;}.calAdjacentMonthDay{color:lightgray;}.calSelectedDay{color:red;font-weight:bold;}#calTitle{width:110px;}.calCtrl{font-size:20px;padding:0px 8px;user-select:none;}</style><div id="calContainer" tabindex="0"><div id="calHeader"><div id="calCtrlPrevYear" class="calCtrl">&#9668;&#9668;</div><div id="calCtrlPrevMonth" class="calCtrl">&#9668;</div><div id="calTitle"></div><div id="calCtrlNextMonth" class="calCtrl">&#9658;</div><div id="calCtrlNextYear" class="calCtrl">&#9658;&#9658;</div><div id="calCtrlHideCal" class="calCtrl">&#10005;</div></div><div id="calGrid"><div class="calDayName"></div><div class="calDayName"></div><div class="calDayName"></div><div class="calDayName"></div><div class="calDayName"></div><div class="calDayName"></div><div class="calDayName"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div></div></div>'}static get observedAttributes(){return["init-date","ignore-on-focus","sunday-first","persist-on-select","show-close-icon"]}disconnectedCallback(){}attributeChangedCallback(i,t,s){"init-date"===i?this.initDate=s:"ignore-on-focus"===i?this.ignoreOnFocus=!0:"sunday-first"===i?this.sundayFirst=!0:"persist-on-select"===i?this.persistOnSelect=!0:"show-close-icon"===i&&(this.showCloseIcon=!0)}connectedCallback(){setTimeout((()=>{this.init()}),0)}init(){if(this.v=this.querySelector("input"),null===this.v)return;var i=document.createElement("div");i.style.display="inline-block",this.o&&this.o.remove(),this.o=this.appendChild(i);const t=document.createElement("template");var s;t.innerHTML=this.h,this.o.appendChild(this.v),this.o.appendChild(t.content),this.u=this.querySelector("#calTitle"),this.D=this.querySelector("#calContainer"),this.p=new Date,null!==this.initDate?(s=this.C(this.initDate)).valid?(this.p=new Date(s.m,s.g,s._),this.i=!0,this.v.value=this.N(this.p)):"current"===this.initDate&&(this.i=!0,this.v.value=this.N(this.p)):(s=this.C(this.v.value)).valid?(this.p=new Date(s.m,s.g,s._),this.i=!0):this.i=!1,this.initDate=null,this.k=this.p.getMonth(),this.H=this.p.getFullYear(),this.D.style.display="none",this.M(),this.S(),this.A(),this.ignoreOnFocus||(this.v.onfocus=this.T,this.v.onfocus=this.v.onfocus.bind(this)),this.v.oninput=this.P,this.v.oninput=this.v.oninput.bind(this),this.v.onblur=this.I,this.v.onblur=this.v.onblur.bind(this),this.D.onblur=this.I,this.D.onblur=this.D.onblur.bind(this),this.showCloseIcon||(this.querySelector("#calCtrlHideCal").style.display="none")}setFocusOnCal(){this.D&&(this.D.style.display="block",this.D.focus())}Y(i){this.i=!0,this.j(i.target.innerHTML,this.k,this.H),this.v.value=this.N(this.p),this.v.dispatchEvent(new CustomEvent("dateselect")),this.A(),this.persistOnSelect||this.O()}O(){this.F().blur()}F(){return this.getRootNode&&this.getRootNode()&&this.getRootNode().activeElement?this.getRootNode().activeElement:document.activeElement}L(i){"Enter"===i.key&&this.Y(i)}I(){setTimeout((()=>{var i;"calContainer"===(i=this).F().id||i.F().classList.contains("calCtrl")||i.F().classList.contains("calDay")||i.F().isSameNode(i.v)||(i.D.style.display="none",i.J(),i.i||i.v.dispatchEvent(new Event("invalid")))}),0)}S(){for(var i=this.D.querySelectorAll(".calCtrl").entries(),t=i.next();!1===t.done;)t.value[1].tabIndex=0,t.value[1].onblur=this.I,t.value[1].onblur=t.value[1].onblur.bind(this),t.value[1].onclick=this.R,t.value[1].onclick=t.value[1].onclick.bind(this),t.value[1].onkeydown=this.R,t.value[1].onkeydown=t.value[1].onkeydown.bind(this),t.value[1].onmousedown=this.V,t.value[1].onmousedown=t.value[1].onmousedown.bind(this),t.value[1].onmouseup=this.J,t.value[1].onmouseup=t.value[1].onmouseup.bind(this),t.value[1].onmouseleave=this.J,t.value[1].onmouseleave=t.value[1].onmouseleave.bind(this),t.value[1].ontouchstart=this.V,t.value[1].ontouchstart=t.value[1].ontouchstart.bind(this),t.value[1].ontouchend=this.J,t.value[1].ontouchend=t.value[1].ontouchend.bind(this),t.value[1].ontouchcancel=this.J,t.value[1].ontouchcancel=t.value[1].ontouchcancel.bind(this),t=i.next()}G(i){this.t.push(setInterval((()=>{this.R(i)}),this.longPressInterval)),this.querySelector("#"+i.target.id).onclick=()=>{this.K(i,this)}}K(i,t){t.querySelector("#"+i.target.id).onclick=t.R,t.querySelector("#"+i.target.id).onclick=t.querySelector("#"+i.target.id).onclick.bind(t)}V(i){this.l.push(setTimeout((()=>{this.G(i)}),this.longPressThreshold))}J(){this.l.forEach(clearTimeout),this.l=[],this.t.forEach(clearInterval),this.t=[]}C(i){var t,s,a,l={},n=i.match(/^\s*(\d{1,2})\.(\d{1,2})\.(\d\d\d\d)\s*$/);return null===n?l.valid=!1:(t=Number(n[1]),s=Number(n[2]),a=Number(n[3]),this.U(t,s,a)?(l.valid=!0,l._=t,l.g=s-1,l.m=a):l.valid=!1),l}P(){var i=this.C(this.v.value);i.valid?(this.i=!0,this.j(i._,i.g,i.m),this.k=i.g,this.H=i.m,this.v.dispatchEvent(new CustomEvent("dateselect")),this.A()):this.i=!1}U(i,t,s){if(t<1||t>12)return!1;var a=this.W(t,s);return!(i<1||i>a)}R(i){if("Enter"===i.key||"keydown"!==i.type)switch(i.target.id){case"calCtrlPrevYear":this.$();break;case"calCtrlNextYear":this.q();break;case"calCtrlPrevMonth":this.B();break;case"calCtrlNextMonth":this.X();break;case"calCtrlHideCal":this.O()}}T(){this.P(),this.D.style.display="block"}q(){this.H++,this.A()}$(){this.H--,this.A()}X(){11===this.k?(this.k=0,this.H++):this.k++,this.A()}B(){0===this.k?(this.k=11,this.H--):this.k--,this.A()}A(){var i=new Date(this.H,this.k);i.setDate(1),this.u.innerHTML=this.monthNames[this.k]+" "+this.H;var t=[],s=[];this.Z(i,t,s);for(var a=this.D.querySelectorAll(".calDay").entries(),l=a.next();!1===l.done;)l.value[1].classList.remove("calAdjacentMonthDay"),l.value[1].classList.remove("calSelectedDay"),l.value[1].classList.remove("calHiddenRow"),l.value[1].classList.remove("calDayStyle"),l.value[1].onclick=null,l.value[1].onblur=null,l.value[1].onkeydown=null,s[l.value[0]]?l.value[1].classList.add("calAdjacentMonthDay"):l.value[1].classList.add("calDayStyle"),l.value[1].innerHTML=t[l.value[0]],this.k!==this.p.getMonth()||this.H!==this.p.getFullYear()||t[l.value[0]]!==this.p.getDate()||s[l.value[0]]||l.value[1].classList.add("calSelectedDay"),s[l.value[0]]?l.value[1].removeAttribute("tabindex"):(l.value[1].onclick=this.Y,l.value[1].onclick=l.value[1].onclick.bind(this),l.value[1].onkeydown=this.L,l.value[1].onkeydown=l.value[1].onkeydown.bind(this),l.value[1].tabIndex=0,l.value[1].onblur=this.I,l.value[1].onblur=l.value[1].onblur.bind(this)),l=a.next();if(s.slice(35,42).every((i=>!0===i)))for(l=(a=this.D.querySelectorAll(".calDay").entries()).next();!1===l.done;)l.value[0]>34&&l.value[1].classList.add("calHiddenRow"),l=a.next()}getDateString(){return this.i?this.N(this.p):null}getDateObject(){return this.i?this.p:null}j(i,t,s){i=Number(i),t=Number(t),s=Number(s),i===this.p.getDate()&&t===this.p.getMonth()&&s===this.p.getFullYear()||(this.p.setFullYear(s),this.p.setMonth(t,i))}N(i){var t=i.getFullYear(),s=i.getMonth()+1;return i.getDate()+"."+s+"."+t}M(){var i=[];i=this.dayNames.slice(),this.sundayFirst&&(i.pop(),i.unshift(this.dayNames[6]));for(var t=this.D.querySelectorAll(".calDayName").entries(),s=t.next();!1===s.done;)s.value[1].innerHTML=i[s.value[0]],s=t.next()}Z(i,t,s){var a,l=i.getDay(),n=i.getMonth()+1,e=i.getFullYear(),h=this.W(n,e);i.setDate(i.getDate()-1);var c=i.getMonth()+1,d=i.getFullYear(),r=this.W(c,d);if(this.sundayFirst)for(a=0;a<l;a++)t.unshift(r),r--,s.push(!0);else if(0===l)for(a=0;a<6;a++)t.unshift(r),r--,s.push(!0);else for(a=0;a<l-1;a++)t.unshift(r),r--,s.push(!0);for(a=0;a<h;a++)t.push(a+1),s.push(!1);var v=42-t.length;for(a=0;a<v;a++)t.push(a+1),s.push(!0)}ii(i){return i%4==0&&i%100!=0||i%400==0}W(i,t){return 1===i||3===i||5===i||7===i||8===i||10===i||12===i?31:4===i||6===i||9===i||11===i?30:2===i&&this.ii(t)?29:2!==i||this.ii(t)?void 0:28}}customElements.define("wc-datepicker",Datepicker);